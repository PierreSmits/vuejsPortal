= Guide des développements dans OFBiz par l'exemple
January 24, 2013 +
revu complétement en juin 2018

//:imagesdir: ./../images_fr
//:imagesdir: ../../plugins/vuejsPortal/src/docs/asciidoc/images_fr


== Objectif de Example
// <revhistory>
//       <revision><revnumber> 0.1.0</revnumber><date>26 Janvier 2013</date><authorinitials>OHE</authorinitials></revision>
//     </revhistory>

[NOTE]
Transféré dans <<_objectif_du_composant_example, introduction du composant example>>

[NOTE]
La documentation de ofbiz est actuellement en train d'être ré-organisé, ce qui fait que l'aide contextuel n'est, momentanément plus maintenu 
et donc un peu ancienne. + 
Dans ce composant, vous pouvez lire l'aide de chaque écran, celle-ci vous expliquera quelle partie du développement est utilisé dans ce cas, 
mais si des explications vous semble en contradiction avec cette documention, c'est que ces explications ne sont plus valables.  

=== Arborescence des fichiers sources

[IMPORTANT]
cette section doit être transféré dans l'introduction de ce docuement

Au niveau de l'arborescence il y a plusieurs répertoires principaux : 

[source]
--
ofbiz-framework/
├── applications/        - Les composants applicatifs majeurs
├── docs/                - Les fichiers root de chacune des documentations
├── framework/           - Les composants techniques
├── lib/                 - Vide au départ pour y mettre des lib complémentaires 
├── plugins/             - Répertoire à créer pour y mettre tous les plugins, composants applicatifs complémentaires ou extention de composant existant
├── themes/              - Les différents thèmes disponible
├── runtime/             - Utilisés lors du fonctionnement
    ├── catalina/
    ├── data/            - les données de la base derby quand celle-ci est utilisé (paramétrage par défaut, utilisable pour des démos)
    ├── indexes/         - pour les indexe de Lucène (& solr)
    ├── logs/ 
    ├── output/          - utilisé quand il y a des fichiers uploadé via le composant content
    ├── tmp/             - idem ci-dessus
    └── tempfiles/
--



[[_development]]
== Comment développer dans OFBiz
// <revhistory>
//       <revision><revnumber> 0.1.0</revnumber><date>21 février 2013</date><authorinitials>OHE</authorinitials></revision>
//     </revhistory>

Comment développer un nouvelle écran, personnaliser un existant, ajouter une table dans la base de donné, écrire un programme métier, ...




[[_devel_portal_portlet]]
== Pratiques de développement, Page portail et portlet

L'usage des pages portails et des portlets pour définir les interfaces utilisateurs est grandement recommandé.

Une page portail contient des colonnes et celle-ci contiennent des portlets, et ces portlets sont entièrement configurables :  titre, disposition sur la page, menus, script,...

De très nombreuse portlet existe déjà et dans bien des cas, lors de la création d'une page portail pour un nouveau besoin, il ne sera pas nécessaire de créer de nouvelle portlet, juste sélectionner les bonnes et les configurer.

Néanmoins, créer/développer une nouvelle portlet est simple, en effet un ensemble de portlet type a été défini pour répondre aux besoins les plus classiques lors du développement des interfaces.

Ainsi dans la plupart des cas, il suffit de définir un formulaire (une "Form") au bon endroit, dans le bon fichier, et la portlet est directement utilisable.

Cette partie a pour but de décrire les outils et les recommandations à disposition pour réaliser des interfaces  standards et configurables dans les meilleurs délais.

Pour une meilleur vision des interactions entre les notions de PortalPage, Portlet, attribues, voici le diagram UML des données 
utilisés pour la gestion des PortalPages. 

image::PortalUml.png[Diagramme UML des entités Portal]

[[_devel_portlet]]
=== Les portlets

Il faut d'abord identifier le <<_portlet_type_13,Types de la portlets>>.

Une fois son type sélectionné, il va falloir configurer la portlet en fonction des besoins de votre écran : 

* configuration du titre de la portlet
* configuration du screen ou du form utilisé
* utilisation d'un script avant le chargement de la portlet (récupération d'une liste, test de données, actions diverses)
* utilisation d'un menu (en haut dans la barre de titre du screenlet)
* utilisation d'un test sur une variable pour afficher ou non le contenu de la portlet
* $$...$$


La majorité des éléments configurables sur une portlet ont des valeurs par défaut qui évitent d'avoir à les définir lors de la création des portlets.

Ainsi, lorsqu'on regarde le fichier de définition des portlets ExamplePortletData.xml, très peu de champs sont renseignés, principalement ceux concernant la portlet elle-même. 

* configuration du titre de la portlet
* configuration du screen ou du form utilisé
* utilisation d'un script avant le chargement de la portlet (récupération d'une liste, test de données, actions diverses)
* utilisation d'un menu (en haut dans la barre de titre du screenlet)
* utilisation d'un test sur une variable pour afficher ou non le contenu de la portlet
* $$...$$

Et voici des extraits : 
[source]
----

<PortalPortlet portalPortletId="FindExample"
   portletName="Find Example (with portletType and showPortlet)" description="portlet to define search criteria for Example list"
   portletTypeId="Screenlet"  component="example" subComponent="Example" helpName="HELP_Screenlet"/>
<PortalPortlet portalPortletId="ListExample"
   portletName="List Examples (with portletType and showPortlet)" description="portlet to list example depending on search criteria, this portlet is call by FindExample"
   portletTypeId="ScreenletList" component="example" subComponent="Example" helpName="HELP_ScreenletList"/>
----

Pour garantir la qualité de cette page portail, il est important de penser aux traductions (CommonPortalEntityLabels.xml) : 
[source]
----

<property key="PortalPortlet.portletName.FindExample">
    <value xml:lang="en">Find Example </value>
    <value xml:lang="fr">Rechercher un exemple </value>
</property>
<property key="PortalPortlet.description.FindExample">
    <value xml:lang="en">portlet to define search criteria for Example list </value>
    <value xml:lang="fr">portlet (type Screenlet) de critères de recherche pour la liste des exemples </value>
</property>
----

[[_devel_portlet_category]]
==== Catégorie d'une portlet

Il est possible d'affecter une portlet à une ou plusieurs catégories, cela afin de permettre de rechercher plus  facilement les portlets.

Habituellement, il y a une catégorie par composant ou par 
objet métier:: mais rien n'empêche dasn créer en fonction de besoin spécifiques.
Lors de la création d'un catégorie il est possible de l'associer à une catégorie parente.

Ligne à ajouter dans le fichier data pour associer une catégorie à une portlet : 
[source]
----

<PortletPortletCategory portalPortletId="FindExample2" portletCategoryId="EXAMPLE"/>
----

[[_portlet_portletfields]]
==== Description des champs définissant une portlet
// <titleabbrev>Champs de PortalPortlet</titleabbrev>

Les différents champs de l'entité PortalPortlet définissent le fonctionnement des portlet.
Ils sont listés  ci-dessous.

Certains champs ont des valeurs par défaut (scriptName, menuName, screenName or formName), d'autres doivent être obligatoirement renseignés (l'identifiant, le type, le composant et sous-composant,...). 

.Utilisez les valeurs par défaut
[TIP]
====
Avec les champs component et subcomponent renseignés, il y aura des valeurs par défaut pour beaucoup des autres champs.
Il est trés fortement conseillé d'utiliser ces valeurs par défaut quand c'est possible
====
// <segmentedlist>
//             <segtitle>portalPortletId</segtitle>
//             <segtitle>portletLongId</segtitle>
//             <segtitle>portletTypeId</segtitle>
//             <segtitle>portletName</segtitle>
//             <segtitle>description</segtitle>
//             <segtitle>component</segtitle>
//             <segtitle>subComponent</segtitle>
//             <segtitle>webapp</segtitle>
//             <segtitle>screenshot</segtitle>
//             <segtitle>titleLabel</segtitle>
//             <segtitle>formName</segtitle>
//             <segtitle>formLocation</segtitle>
//             <segtitle>useScreen</segtitle>
//             <segtitle>screenName</segtitle>
//             <segtitle>screenLocation</segtitle>
//             <segtitle>useMenu</segtitle>
//             <segtitle>menuName</segtitle>
//             <segtitle>menuLocation</segtitle>
//             <segtitle>editAreaDivId</segtitle>
//             <segtitle>subAreaDivId</segtitle>
//             <segtitle>useScript</segtitle>
//             <segtitle>scriptName</segtitle>
//             <segtitle>pkIdname</segtitle>
//             <seglistitem>
//               <seg>identifiant de la portlet, max. 20 carac</seg>
//               <seg>identifiant complémentaire, max. 60 carac</seg>
//               <seg>renseigner avec le type choisi, ici, Screenlet</seg>
//               <seg>description courte, penser aux labels de traductions dans CommonPortalEntityLabels.xml</seg>
//               <seg>description longue, penser aux labels de traductions dans CommonPortalEntityLabels.xml</seg>
//               <seg>nom du composant, trés important pour générer les valeurs par défaut des autres champs utilisées par ce type de portlet</seg>
//               <seg>nom du sous-composant, trés important pour générer les valeurs par défaut des autres champs utilisées par ce type de portlet</seg>
//               <seg>à renseigner lorsqu'on utilise des sous-répertoire dans le sous composant</seg>
//               <seg>image png de la portlet</seg>
//               <seg>titre à afficher</seg>
//               <seg>optionnel, dépend du champ useScreen, il est utilisé si useScreen est vide ou N</seg>
//               <seg>voir ci-dessus</seg>
//               <seg>doit être à Y si un screen est utlisé pour cette portlet</seg>
//               <seg>optionnel, il est utilisé si useScreen est Y</seg>
//               <seg>voir ci-dessus</seg>
//               <seg>doit être à Y si un menu est utlisé pour cette portlet</seg>
//               <seg>ajout d'un menu en haut à droite de la screenlet, il est utilisé si useMenu est Y</seg>
//               <seg>voir ci-dessus</seg>
//               <seg>zone d'édition en haut du screen ou du form utilisé, premet d'injecter du contenu (via le menu, par exemple)</seg>
//               <seg>zone contenant le screen ou le form utilisé, permet de remplacer le contenu de cette zone (via le menu, par exemple)</seg>
//               <seg/>
//               <seg>il est utilisé si useScript est Y</seg>
//               <seg>nom de la variable qui doit être non vide pour que la portlet s'affiche</seg>
//             </seglistitem>
//           </segmentedlist>


.Retrouvez cette aide et plus, directement dans webtools
[TIP]
====
Lors de la réalisation d'une portlet, en cas de doute, il est possible de visualiser les valeurs par défaut  généré, via la page _Montrer les champs d'une portlet_ :

**Fil d'ariane**: Adm.
Sys > DIVERS OUTILS DE CONFIGURATION (dans la page d'accueil) > Montrer les champs d'une portlet ou directement l'uri /webtools/control/ShowPortalPortlet

Dans cette page, en passant la souris sur le nom des champs, une description détaillée du champ apparait,  ainsi que le détail de la construction de la valeur par défaut pour ce champ
====

[[_portlet_type_13]]
==== Types de portlets

Pour faciliter la création de portlets, il existe plusieurs types de portlets correspondant chacune à un usage  classsique dans des pages portail.

Ces types intègre une quantité d'objets et d'actions qui pourront être mis en oeuvre lors de la  configuration de la portlet.

.Liste des différents types de portlet existants pour le moment
[cols="1,1", options="header"]
|===
| Type
| Description

|Screenlet
|type générique

|ScreenletList
|type générique pour une liste

|Empty
|contener vide pour permettre l'injection de portlet

|Decorator
|type permettant de charger la portlet via une URI dédié
|===

[[_portlet_screenlet]]
===== Portlet de type Screenlet
// <titleabbrev>Screenlet</titleabbrev>

**C'est le type le plus courant de portlet.**Il permet de gérer des screens ou  des forms avec menu et zone d'édition (injection ou substitution).

On peut également éxécuter un script avant le chargement de la portlet pour récupérer entité, listes,...

Lorsqu'on crée une nouvelle porlet, il faut définir un certain nombre de champs pour garantir son fonctionnement et sa réutilisation.

Il faut réfléchir à quel composant se rattache cette portlet et ses fonctionnalités.
Une fois le composant et  sous-composant identifiés, il faut decrire la fonction de la portlet du mieux possible.




image::example_fr/Screenlet.png[]


====== Champs importants de l'entité PortalPortlet
// <titleabbrev>Champs importants</titleabbrev>

// <segmentedlist>
//                 <segtitle>portalPortletId</segtitle>
//                 <segtitle>portletLongId</segtitle>
//                 <segtitle>portletTypeId</segtitle>
//                 <segtitle>portletName</segtitle>
//                 <segtitle>description</segtitle>
//                 <segtitle>component</segtitle>
//                 <segtitle>subComponent</segtitle>
//                 <segtitle>webapp</segtitle>
//                 <segtitle>screenshot</segtitle>
//                 <seglistitem>
//                   <seg>identifiant de la portlet, max. 20 carac</seg>
//                   <seg>identifiant complémentaire, max. 60 carac</seg>
//                   <seg>renseigner avec le type choisi, ici, Screenlet</seg>
//                   <seg>description courte, penser aux labels de traductions dans CommonPortalEntityLabels.xml</seg>
//                   <seg>description longue, penser aux labels de traductions dans CommonPortalEntityLabels.xml</seg>
//                   <seg>nom du composant, trés important pour générer les valeurs par défaut des autres champs utilisées par ce type de portlet</seg>
//                   <seg>nom du sous-composant, trés important pour générer les valeurs par défaut des autres champs utilisées par ce type de portlet</seg>
//                   <seg>à renseigner lorsqu'on utilise des sous-répertoire dans le sous composant</seg>
//                   <seg>image png de la portlet</seg>
//                 </seglistitem>
//               </segmentedlist>

Ensuite, on peut utilisés les champs complémentaires ou optionnels.

.Utilisez les valeurs par défaut
[TIP]
====
Avec les champs component et subcomponent renseignés, il y aura des valeurs par défaut pour beaucoup des autres champs.
====

====== Champ de l'entité PortalPortlet utilisés par le type Screenlet (à renseigner uniquement si valeur spécifique)
// <titleabbrev>Champs utilisés par ce type</titleabbrev>

// <segmentedlist>
//                 <segtitle>titleLabel</segtitle>
//                 <segtitle>formName</segtitle>
//                 <segtitle>formLocation</segtitle>
//                 <segtitle>useScreen</segtitle>
//                 <segtitle>screenName</segtitle>
//                 <segtitle>screenLocation</segtitle>
//                 <segtitle>useMenu</segtitle>
//                 <segtitle>menuName</segtitle>
//                 <segtitle>menuLocation</segtitle>
//                 <segtitle>editAreaDivId</segtitle>
//                 <segtitle>subAreaDivId</segtitle>
//                 <segtitle>useScript</segtitle>
//                 <segtitle>scriptName</segtitle>
//                 <segtitle>pkIdname</segtitle>
//                 <seglistitem>
//                   <seg>titre à afficher</seg>
//                   <seg>optionnel, dépend du champ useScreen, il est utilisé si useScreen est vide ou N</seg>
//                   <seg>voir ci-dessus</seg>
//                   <seg>doit être à Y si un screen est utlisé pour cette portlet</seg>
//                   <seg>optionnel, il est utilisé si useScreen est Y</seg>
//                   <seg>voir ci-dessus</seg>
//                   <seg>doit être à Y si un menu est utlisé pour cette portlet</seg>
//                   <seg>ajout d'un menu en haut à droite de la screenlet, il est utilisé si useMenu est Y</seg>
//                   <seg>voir ci-dessus</seg>
//                   <seg>zone d'édition en haut du screen ou du form utilisé, premet d'injecter du contenu (via le menu, par exemple)</seg>
//                   <seg>zone contenant le screen ou le form utilisé, permet de remplacer le contenu de cette zone (via le menu, par exemple)</seg>
//                   <seg/>
//                   <seg>il est utilisé si useScript est Y</seg>
//                   <seg>nom de la variable qui doit être non vide pour que la portlet s'affiche</seg>
//                 </seglistitem>
//               </segmentedlist>


.Retrouvez cette aide et plus, directement dans webtools
[TIP]
====
Pour plus d'information voir l'aide détaillé des <<_portlet_portletfields,
                  champs d'une portlet>>

Lors de la réalisation d'une portlet, en cas de doute, il est possible de visualiser les valeurs par défaut  généré, via la page Montrer les champs d'une portlet :

**Fil d'ariane **: Adm.
Sys > DIVERS OUTILS DE CONFIGURATION (dans la page d'accueil) > Montrer les champs d'une portlet  ou directement l'uri /webtools/control/ShowPortalPortlet

Dans cette page, en passant la souris sur le nom des champs, une description détaillée du champ apparait,  ainsi que le détail de la construction de la valeur par défaut pour ce champ
====

====== Les attributs génériques possible

Par défaut ce type de portlet est réductible avec save-collapsed="true"

* collapsible : si vide c'est true _non opérationnel : true pour le moment_
* saveCollapsed : si vide c'est true _non opérationnel : true pour le moment_
* initiallyCollapsed : si vide c'est false


[[_portlet_screenletlist]]
===== Portlet de type ScreenletList

Ce type de portlet est utilisé lorsque l'on a besoin d'une liste.
En effet, les listes imposent, du fait du système de pagination,  d'utiliser un form comme contenu.
Ainsi il faut simplement créer le Form en respectant les règles de nommages. 

Usage classique : gérer une liste d'enregistrement avec possibilité de les éditer.

Lorsqu'on crée une nouvelle porlet, il faut définir un certain nombre de champs pour garantir son fonctionnement et sa réutilisation.

Il faut réfléchir à quel composant se rattache cette portlet et ses fonctionnalités.
Une fois le composant et sous-composant identifiés, il faut decrire la fonction de la portlet du mieux possible.




image::example_fr/ScreenletList.png[]


====== Champ génériques de l'entité PortalPortlet

* portalPortletId : identifiant de la portlet, max. 20 carac.
* portletLongId : identifiant complémentaire, max. 60 carac.
* portletTypeId : renseigner avec le type choisi, ici, ScreenletList
* portletName : descrition courte, penser aux labels de traductions dans CommonPortalEntityLabels.xml
* descrition : descrition longue, penser aux labels de traductions dans CommonPortalEntityLabels.xml
* component : nom du composant, à renseigner pour générer les valeurs par défaut utilisées par le type de portlet
* subComponent : nom du sous-composant, à renseigner pour générer les valeurs par défaut utilisées par le type de portlet
* webapp : à renseigner lorsqu'on utilise des sous-répertoire dans le sous composant
* screenshot : image png de la portlet

Ensuite, on peut utilisés les champs complémentaires ou optionnels.

[TIP]
====
Avec les champs component et subcomponent renseignés, il y aura des valeurs par défaut pour beaucoup des autres champs.
====

====== Champ de l'entité PortalPortlet utilisés par type Screenlet (à renseigner uniquement si valeur spécifique)

* titleLabel : titre à afficher
* formName : optionnel, dépend du champ useScreen, il est toujours utilisé
* formLocation : voir ci-dessus
* useScreen
* screenName : optionnel, s'il est présent, il sera utilisé en plus de la form
* screenLocation : voir ci-dessus
* useMenu
* menuName : ajout d'un menu en haut à droite de la screenlet, il est utilisé si useMenu est Y
* menuLocation : voir ci-dessus
* editAreaDivId : zone d'édition en haut du screen ou du form utilisé, premet d'injecter du contenu (via le menu, par exemple)
* subAreaDivId : zone contenant le screen ou le form utilisé, permet de remplacer le contenu de cette zone (via le menu, par exemple)
* useScript
* scriptName, il est utilisé si useScript est Y 
* pkIdname

Par défaut ce type de portlet est réductible avec save-collapsed="true"

[TIP]
====
Pour plus d'information voir l'aide détaillé des `champs d'une portlet`

Lors de la réalisation d'une portlet, en cas de doute, il est possible de visualiser les valeurs par défaut généré, via la page `ShowPortalPortlet` dans Adm.
Sys
====

====== Les attributs génériques possible

* collapsible : si vide c'est true _non opérationnel : true pour le moment_
* saveCollapsed : si vide c'est true _non opérationnel : true pour le moment_
* initiallyCollapsed : si vide c'est false


====== Liens complémentaires

* Voir `tous les Types de portlet et les champs`
* Voir `la liste complète des champs et leur description`


[[_help_empty]]
===== Portlet de type Empty




image::example_fr/Empty.png[type de portlet Empty]

Ce décorateur permet de définir une portlet comme un conteneur d'autres portlets.
Ainsi, au moyen d'une navigation par menu, on peut charger une portlet dans cette zone de contenu.
Voir la portlet ExampleDetail et la portlet de menu qui la gère. 

Usage classique : sert à définir une zone chargement de portlets commandée par une autre portlet contenant un menu.

====== Liens complémentaires

<<_portlet_type_13,retour au menu "Types de portlet">>

Voir `tous les Types de portlet et les champs`

Voir `la liste complète des champs d'une portlet`

[[_help_decorator]]
===== Utilisation du type de portlet Decorator




image::example_fr/Decorator.png[type de portlet Decorator]

<<_portlet_type_13,retour au menu "Types de portlet">>

Contient juste, le decorator qui permet la gestion des traductions dans le composant où la portlet sera utilisée (chargement des uiLabel). Ce decorator est utilisé par les portlets type Screenlet et ScreenletList. 

L'usage de ce type de portlet permet de faire une portlet à partir d'un screen, sans avoir à se soucier du chargement des uiLabels,  il est conseillé de l'utiliser pour être homogène en terme d'usage des uiLabel pour toutes les portlets.

Il sera utilisé chaque fois que l'on a besoin d'un screen spécifique

====== Champs optionnels de l'entité PortalPortlet utilisés

* uiLabelLocation
* useScreen, mettre Y
* screenName
* screenLocation

Voir `la liste complète des champs d'une portlet`

[[_help_portletattrs]]
==== Attributs d'une portlet

Les portlet utilisent des attributs pour permettre de rendre configurable cette portlet.

En effet, plus une porlet est configurable, plus il sera aisée de l'utiliser dans un autre contexte, sur une autre page.



===== Gestion des attributs

Un exemple d'attributs standard fixé lors de la configuration : l'attribut "initiallyCollapsed" est un attribut générique utilisé par les types de portlets Screenlet et ScreenletList  pour déterminer si la screenlet sera initialement fermée ou ouverte.
Ici, on configure sa valeur pour une page portail et une portlet données. 
[source]
----

<PortletAttribute portalPageId="ExampleNew" portalPortletId="FindExample2" attrName="initiallyCollapsed" attrValue="true" portletSeqId="00001"/>
----

Ensuite, on peut créer son propre attribut qui sera utilisé par le script (par exemple) pour rechercher une liste (par exemple une liste d'acteurs avec un rôle défini). Ainsi, on pourra utiliser la portlet pour différentes valeurs de cet attributs (par exemple, une portlet acteur permet de filtrer sur des propects, des employés,...). 
[source]
----

<PortletAttribute portalPageId="ExampleMgmt" portalPortletId="ListExample2" attrName="roleTypeId" attrValue="VENDOR" portletSeqId="00001"/>
----

[[_help_example_pages]]
=== Utilisation des pages portail

Une page portail est composée d'une ou plusieurs portlets organisées autour de colonnes et d'un séquençage 

Et voici un exemple de configuration de page portail : 
[source]
----

        <PortalPage portalPageId="ExampleMgmt"  sequenceNum="200" parentPortalPageId="EXAMPLE" 
                           portalPageName="Example management" description="Search, list, navigation menu, edit area" ownerUserLoginId="_NA_"/>
        <PortalPageColumn portalPageId="ExampleMgmt" columnSeqId="00001" columnWidthPercentage="25"/>
        <PortalPagePortlet portalPageId="ExampleMgmt" portalPortletId="FindExample" portletSeqId="00001" columnSeqId="00001" sequenceNum="1"/>
        <PortalPagePortlet portalPageId="ExampleMgmt" portalPortletId="ExampleDetailsMenu" portletSeqId="00001" columnSeqId="00001" sequenceNum="10"/>
        <PortalPageColumn portalPageId="ExampleMgmt" columnSeqId="00002"/>
        <PortalPagePortlet portalPageId="ExampleMgmt" portalPortletId="ListExample" portletSeqId="00001" columnSeqId="00002" sequenceNum="20"/>
        <PortalPagePortlet portalPageId="ExampleMgmt" portalPortletId="ExampleDetail" portletSeqId="00001" columnSeqId="00002" sequenceNum="30"/>
----

Pour garantir la qualité de cette page portail, il est important de penser aux traductions (CommonPortalEntityLabels.xml) : 
[source]
----

        <property key="PortalPage.portalPageName.ExampleMgmt">
            <value xml:lang="en">Examples management </value>
            <value xml:lang="fr">Gestion des exemples </value>
        </property>
----

==== Les Pages Portails Types

La notion de page portail type n'existe que au niveau des bonnes pratiques.
Vous pouvez agencer le contenu de vos pages portails  comme vous le souhaitez, mais nous avons déterminé 3 pages type que l'on rencontre dans la plupart des composants.
Lors de la création de  page portail pour un nouveau composant, il est conseillé de commencer par ces trois pages type 

* <<_help_ppage_mgmt,Les pages de gestion d'entité majeure>> (Gestion des acteurs, gestion des commandes,...)
* <<_help_ppage_recap,"Les pages de résumé,">> qui regroupent une sélection de portelts autour d'une entité majeure (rôles, groupes, coordonnées d'un acteur ;  lignes d'une commande, informations d'expédition de la commande,...)
* <<_help_ppage_new,Les pages de création>> d'entité majeure, avec enchainement d'actions mineures après création

Pour avoir la liste complète, passer par l'index.

[[_help_ppage_mgmt]]
===== Page portail de recherche et gestion d'une entité métier majeur

Ce type de page permet de faire des recherches sur une entité métier, et à partir de la liste des résultats de visualiser chacune des  entités associées.
A partir de la liste des résultats, il y a aussi un lien vers une page de synthése de l'entité, c'est à dire visualiser l'ensemble des entités associées, pour une instance de l'entité. 




image::example_fr/MgmtPage_FR.png[Page portail type : Gestion]


====== Les autres Page Type



* <<_help_ppage_recap,Page Recapitulative>>
* <<_help_ppage_new,Page Création>>


[[_help_ppage_new]]
===== Page portail permettant de créer pour un enregistrement d'une entité métier majeur

Ce type de page permet de créer un enregistrement d'une entité métier et puis de le compléter via l'ajout d'association à un ensemble  d'entités associées. 




image::example_fr/NewPage_FR.png[Page Portail Type : Création]


====== Les autres Page Type



* <<_help_ppage_mgmt,Page Recherche et gestion>>
* <<_help_ppage_recap,Page Recapitulative>>


[[_help_ppage_recap]]
===== Page portail récapitulative pour un enregistrement d'une entité métier majeur

Ce type de page permet de gérer une entité métier et un ensemble (ou toutes) d'entités associées. 




image::example_fr/RecapPage_FR.png[Page Portail Type : Recapitulative]


====== Les autres Page Type



* <<_help_ppage_mgmt,Page Recherche et gestion>>
* <<_help_ppage_new,Page Création>>


[[_portal_security]]
=== Gestion de la sécurité

La gestion des droits d'affichage des pages portail et des portlets permet de définir ce qui est voulu en agissant à  quatre niveaux : 

* Au niveau de la page portail il est possible d'associé un "groupe de sécurité", seul les personnes associés à ce groupe pourront afficher cette page et la voir dans les menus (en particulier quand la page est une page fille parentPortalPageId non vide)
* Au niveau de chaque portlet il est possible de définir la "Security Permission" et  la "Security Main Action", donc seul les utilisateurs qui font partis d'un "groupe de sécurité" qui inclus cette "Secuirty Permission Action" pourront l'afficher
* Au niveau de page portail et portlet, en effet les autorisations d'usage d'une portlet peuvent variées selon la page portail utilisé (ex: dans une page client ou un page fournisseur, il y aura de nombreuse portlet similaire mais un commercial n'aura pas les même droit dans les deux pages).
+
Il est possible de définir un service d'autorisation (il doit implémenter l'interface portalSecurityPermission) au niveau d'une page portail.
Ce service est appelé lors de l'affichage d'une page portail et à chaque fois qu'une portlet est  affichée (ou rafraichie) dans la page portail.
Le retour de ce service contiendra forcement une variable hasPermission  qui doit être à true pour pouvoir afficher la page et le résultat de ce service est mis dans le context et est disponible  pour les portlet de la page (il contiendra une variable widgetPermission définie par l'interface).
+
Au niveau du minilangue il y a un tag "check-widget-permission" qui permet de vérifier et/ou créer un élément de la map widgetPermission.
En effet, cette instruction vérifie la présence de ${widget-permission} en tant que clé dans la map si elle n'est pas présente elle l'initialise en testant si l'utilisateur posséde la ${permission}_${action}
* Au niveau de chaque portlet il est possible de définir des attribues (aussi appelé paramétres) qui permettre de modifier le comportement de la portlet. 
+

.Attention
[WARNING]
====
Si des paramétres ont une importance dans la gestion des autorisations, il est impératif que le formulaire d'édition de ces paramètres utilise aussi les règles de sécurité pour l'affichage ou non de ce paramétre.
====

Il y a un exemple d'usage du service d'autorisation pour une page portail dans le composant example. 

[[_portlet_name_conventions]]
=== Règle de nommage

Afin de faciliter la compréhension des noms de page portail et noms de portlet, des conventions de nommage ont été établies : 

* Page portail : 
+
** xxxxRecap : elle contient un ensemble de portlets pour visualiser et/ou gérer un objet et ses entités associées  (les pages profil d'acteur ou Résumé Projet sont de ce type), plus de <<_help_ppage_recap,détails>>
** xxxxMgmt : elle permet de faire une recherche, d'obtenir une liste puis aprés sélection d'un élément de visualiser/gérer entités associées par entités associées
** sub... : c'est une page qui est utilisée en tant que partie d'écran
* Portlet : 
+
** Findxxxs : formulaire de recherche
** Listxxxs : portlet listant l'enregistrement de l'entité, souvent en tant que résultat de la portlet Findxxxs
** xxxSummary : portlet de petite ou moyenne taille uniquement en affichage, destinée à être dans une colonne (25% ou 33%) pour rappeler l'objet sur lequel on travaille
** xxxDetailsMenu : contenu identique à xxxSummary avec un menu permettant d'afficher dans un autre emplacement de l'écran le détail d'entités associés
** xxxDetail : portlet vide permettant de définir l'emplacement (le container) où s'affiche le détail d'entités associés (cf xxxMenuDetail)
** xxxOverview : portlet de moyenne à grande taille, uniquement en affichage, destinée à être dans la colonne principale (50% et plus) qui présente une vue générale de l'objet, au besoin à partir d'éléments d'entités associées (synthèse Projet, Commande)
** xxxCreate : portlet de création, peut contenir des champs liés à des entités associées afin de permettre de créer l'objet et les entités associées en une seule opération. Il peut y avoir similitude de formulaire HTML (form) avec xxxOverview
** xxxUpdate : portlet de mise à jour, ne contient que des champs liés à l'objet, la mise à jour des entités associés se fait via les portlets adéquates
** xxxyyyys ou xxxyyyysList : xxx c'est le nom de l'entité majeure (l'objet) yyyy le nom de l'entité associée, le s pour signaler que c'est une liste


=== Migration d'écran standard

Pour la migration d'écran standard ofbiz en portlet, l'objectif est d'utiliser au maximum : 

. les éléments du standard ofbiz
. Des portlet avec le minimum de champ définis donc avec l'usage du maximum de champ avec leur valeur par défaut.


==== Règles à suivre :



. en cas de doute, regarder comment sont paramétrés les portlet dans l'exemple (/ofbiz/plugins/example/data/ExamplePortletData.xml),  cela correspond aux bonnes pratiques (une bonne pratique qui n'est pas dans exemple n'est pas une bonne pratique)
. sauf cas très particulier, le nom et la location des fichiers (form, menu, script, screen) doivent utiliser les valeurs par défaut
. sauf cas très particulier, une portlet doit avoir un type (Screenlet, ScreenletList, Decorator ou Empty)
. les champs composant, sous-composant et webapp doivent être correctement renseignés (webapp vide ou non)
. mettre dans le bon composant la portlet, une portlet issue d'une form de projectmgr est un élément de WorkEffort s'il n'y a pas de spécificité project. Les uiLabels sont surchargeables par composant donc un titre spécifique n'est pas une bonne raison;  un ou des drop-downs avec des contraintes (parentType = xxx, xxxType= , ...) peuvent facilement être rendus paramétrables.
. sauf cas très particulier, le titre de la screenlet doit utiliser un label existant, bien faire une recherche avant d'en créer un, et si création, le mettre dans le bon composant
. dans la mesure du possible, utiliser uniquement une form. Si possible, celle-ci hérite du formulaire HTML (form) standard, les champs de type lien (edit, remove) étant surchargés pour être des show-portlets, et un on-event-update-area est ajouté s'il y a un bouton submit
. les target pour l'update ou le create doivent utiliser un retour json, afin d'avoir un affichage des messages d'erreur ou de retour correct. 
. les actions d'édition (dans la zone d'editArea) sont la plupart de temp des uri, pas des portlets (sauf usage en tant que tel par ailleurs); par souci d'homogénéité, il faut mettre screen, form dans les mêmes locations que les portlet les utilisant. De même, si possible faire un héritage de la form standard.
. pour l'instant, il n'y a pas consensus concernant le lieu du bouton "annuler" mais comme qui peut le plus, peut le moins, il faut mettre un bouton annuler dans les formulaires d'édition et un bouton dans le menu (en dernier à droite) qui fait un refresh de la portlet
. les uri json (et les uri d'action d'édition) sont à mettre dans le portlet-controller en respectant les bonnes pratiques OFBiz (request sans appel de service sur une ligne ...)
. dans la mesure du possible, utiliser un script (mini-lang) plutôt qu'un screen, si le script est une copie du pavé action du screen, mettre un commentaire ; le script n'a d'intérêt que s'il est utilisé plusieurs fois ou si le résultat est utilisé dans l'en-tête du screenlet (menu ou titre ), sinon autant le mettre dans le pavé action de la form.
. toute partie de code dupliqué (form, screen, menu, script, java) doit posséder un commentaire pour signaler l'origine de la copie et la justification de la copie (pensez à celui qui voudra supprimer la duplication)
. les addons nommé portlet-nomDunComposantStdOfbiz ont pour objectif d'être reversé à OFBiz, ils ne doivent donc contenir que des éléments standards
. portletWidget a pour objectif d'être reversé à OFBiz, pas genericPortlet ; il faut donc dans les addons portlet-nomDunComposantStdOfbiz migrer les portlets qui n'utiliseraient pas portletWidget
. pour tous les liens hyperlink vers d'autres pages (par exemple d'un autre composant), si possible migrer la target vers un showPortalPage et mettre en paramétrage de la nom de la portalPage, normalement ça doit être une page de type xxxxRecap. Bien entendu, paramétrer ou faire la form d'editAttribute.
. pour toutes les form d'editAttribute de portlet, le nom du champ ou son titre doivent être explicites, et si possible avoir un tooltips ; tout paramètre de portlet doit avoir une valeur par défaut (la portlet doit être utilisable sans avoir besoin de saisir une valeur)
. Il faut au minimum disposer des deux pages portails classiques ( xxxMgmt et xxxRecap), les mettre à jour à chaque ajout de portlet
. Dans la mesure du possible, il faut mettre des icônes à la place de libellé. Pour cela, il faut : 
+
** chercher la bonne icône dans la page "Liste des icônes", et donc trouver son nom logique
** exprimer l'image-location en utilisant la map iconsPurpose 
** si le Tooltips par défaut (celui visible dans la page Liste des portlet) est suffisamment clair pour votre usage, utilisez-le via les labels  IconsTooltips_, sinon personnalisez correctement l'image-title en rédigeant un nouveau Tooltips mieux adapté

include::_include/portlet_EXAMPLE_fr.adoc[leveloffset=+1]

include::_include/portlet_EXAMPLE_PORTLET_TYPE_fr.adoc[leveloffset=+1]

include::_include/portlet_XXXXXX_fr.adoc[leveloffset=+1]

[[_portlet_iconslist]]
== Liste des icônes utilisable dans OFBiz

Les icônes sont utiles pour rendre l'interface utilisateur plus agréable.

Afin de garantir l'homogénéité dans l'application, un nom logique a été donné à chacune des icônes et il est conseillé  de n'utiliser que celle-ci.

Afin de pourvoir changer de jeux d'icône en fonction du thèmes, il est conseillé de ne jamais accéder en direct au  fichier image mais de passer par les fichiers properties adéquate.

=== Visualiser les listes des Icons disponible

Dans le composant exemple il y a une page qui vous permet de visualiser l'ensemble des icônes disponibles et  associés à un nom logique

*Fil d'ariane -* Applications > Application exemple >  Liste des icônes utilisable dans les portlets

Dans cette page il est indiqué en première colonne : le nom logique de l'icône (dans l'exemple ci-dessus Details).

En seconde colonne il est indiqué 

* soit ce qui sera affiché en tant qu' "image-title" donc lorsque la souris sera sur l'icône,
* soit la bonne pratique à utiliser.

Si vos laissez la souris sur l'image de l'icône vous aurez l' <<image-title>> par défaut. 


image::example_fr/IconList1_fr.jpg[Liste des icons partie1]



image::example_fr/IconList2_fr.jpg[Liste des icons partie1]



image::example_fr/IconList3_fr.jpg[Liste des icons partie1]


=== Usage des icônes dans un lien (link ou show-portlet)
// <titleabbrev>Usage des icônes dans un lien</titleabbrev>

Voici un exemple d'usage de icône Details 
[source]
----

<show-portlet portlet-id="ShowExample" image-location="${iconsPurpose.Details}" 
                                         image-title="${uiLabelMap.IconsTooltips_Details}">
----

Dans cette page il est indiqué en première colonne : le nom logique de l'icône (dans l'exemple ci-dessus Details).

En seconde colonne il est indiqué soit ce qui sera affiché en tant qu' "image-title" donc lorsque la souris sera sur l'icône, soit la bonne pratique à utilisé.

Si vos laissez la souris sur l'image de l'icône vous aurez l' "image-title" par défaut. 

include::_include/ofbiz_addons_fr.adoc[leveloffset=+0]

include::_include/ofbiz_documentation_fr.adoc[leveloffset=+0]


[glossary]
= Glossary

[#ADDON_OFBIZ]
addon pour OFBiz::
Un addon pour Apache OFBiz c'est :
* une fonction technique ou business, unitaire. Soit, elle peut être utilisée en tant que telle, soit 
  elle est nécessaire pour plus de 2 autres addons,
* son développement et sa maintenance n'est pas plus difficiles qu'un développement réalisé 
  directement dans ofbiz,
* techniquement, un seul fichier (une archive, zip ou jar ou ...) et une page de documentation. +
  Le fichier archive contient l'ensemble des éléments de l'addon :
* un ou plusieurs fichiers de modifications/ajouts à appliquer par fichier ofbiz modifié,
* la documentation de l'addon,
* la liste de ses dépendances ;
* un nom unique,  
* est installable et désinstallable,
* l'installation peut nécessiter qu'ofbiz soit arrêté,
* il y a un mainteneur nommé,
* la documentation doit signaler les paramétrages obligatoires s'il y en a.
          
        
[#ADM_ADDON_MANAGER]
adm Addon manager::
  L'addon manager permet d'installer ou de créer / modifier des addons pour Apache-OFBiz, il est utilisable en ligne
    de commande ou au travers de la page adm-gui dans le composant Adm. Sys.

[#PORTLET_ATTRIBUTE]
Attribue de Portlet::
  Un attribue de portlet est un variable (et donc une valeur) qui peut être créé pour une portlet dans une page portail. +
  Cela permet de personnaliser son fonctionnement ou son aspect selon la page portail où elle est utilisé. +
  L'ajout d'un attribue (ou la modification de sa valeur) pour une portlet d'une page portail peut se faire via un 
   formulaire dédié de la portlet, accessible via le bouton personalisation de la portlet dans la personalisation de la 
   page portail. Il est aussi possible d'ajouter directement la valeur dans la table PortletAttribute, par exemple via le 
   chargement d'un fichier data
          
[source,xml]
----
<PortletAttribute portalPageId="ExampleMgmt" portalPortletId="ExampleStatus" portletSeqId="00001" attrName="helpAvailable" attrValue="N" />
----

[#FORMAT_DOCBOOK]
Format docbook::
  Le format DocBook a été développé par le consortium OASIS spécifiquement pour la documentation technique. Il 
  fournit un ensemble riche de balises pour décrire le contenu de document. Il est utilisé par énormément de projet
  de logiciel pour leur documentation. +
  Jusqu'à la version 17.12 c'est le format utilisé par Apache OFBiz pour les fichiers de documentation.
          
        
[#OBJET_METIER]
Objet métier::
  Un object métier correspond à une entité majeur de l'application. Cela correspond à une table de la base de 
  donnée. Elle est associé à d'autres entités - les entités liés -. + 
  Pour plus de détail sur les types d'entités / objets voir les <<_entities_used, entités utilisées dans le composant Example>>.

[#OFBIZHELP]
ofbizhelp, moteur d'aide utilisateur::
  Le moteur d'aide qui est inclus dans le noyau OFBiz utilise le moteur de gestion de contenu de OFBiz et construit l'aide
  de manière dynamique, mais pour des raisons de performance, l'interpréteur docbook utilisé dans ce cadre ne traite qu'un nombre
  réduit de type de balise docbook. Ce moteur d'aide est pratique lorsque l'aide doit pouvoir être modifiable par les utilisateurs.
[NOTE]
La documentation de ofbiz est actuellement en train d'être ré-organisé, ce qui fait que l'aide contextuel n'est, momentanément plus maintenu 
et donc un peu ancienne. Dans le future, cela incluera des liens vers la documentation (livre rédigé au format Asciidoc).  
        

[#WEBHELP]
Webhelp, moteur d'aide utilisateur::
  Webhelp est le moteur d'aide OFBiz ajouté par l'addon webhelp en plus du moteur d'aide inclus dans le noyau ofbiz
  ofbizhelp. Le moteur webhelp d'OFBiz est issu du projet Webhelp du projet docbook. Il 
  permet de générer un site d'aide (en html) à partir d'un ou de plusieurs fichiers au format docbook (donc plus maintenu, cf ci-dessus). 
  Le nombre de type de balise docbook supporté est donc très étendu.

